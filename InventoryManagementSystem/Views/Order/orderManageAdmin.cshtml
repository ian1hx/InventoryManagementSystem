<link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css" />
<link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.css" />
<script src="https://unpkg.com/vue/dist/vue.min.js"></script>
<script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

<div id="app">
    <!--提醒-->
    <div>
        <b-button variant="warning" class="font-weight-bolder">
            <img src="/images/timer_black_24dp.svg" />
            待審核訂單 <b-badge variant="light" class="text-dark">4</b-badge>
        </b-button>
        <b-button variant="success" class="font-weight-bolder">
            <img src="/images/lightbulb_white_24dp.svg" />
            待領取訂單 <b-badge variant="light" class="text-dark">4</b-badge>
        </b-button>
        <b-button variant="primary" class="font-weight-bolder">
            <img src="/images/outbox_white_24dp.svg" />
            租借中訂單 <b-badge variant="light" class="text-dark">4</b-badge>
        </b-button>
        <b-button variant="danger" class="font-weight-bolder">
            <img src="/images/new_releases_white_24dp.svg" />
            已逾期訂單 <b-badge variant="light" class="text-dark">4</b-badge>
        </b-button>
        <b-button variant="info" class="font-weight-bolder">
            <img src="/images/pending_actions_black_24dp.svg" />
            使用者申請報修 <b-badge variant="light" class="text-dark">4</b-badge>
        </b-button>
        <b-button variant="dark" class="font-weight-bolder">
            <img src="/images/announcement_white_24dp.svg" />
            使用者申請遺失 <b-badge variant="light" class="text-dark">4</b-badge>
        </b-button>
    </div>

    </br>
    <!--ALL ORDERS-->
    <b-tabs active-nav-item-class="font-weight-bold text-uppercase text-danger"
            active-tab-class="font-weight-bold text-dark" content-class="mt-3" fill>
        <b-tab title="所有訂單" active v-on:click="GetAllOrders">
            <b-navbar-nav class="ml-auto">
                <b-nav-form>
                    <b-form-input size="sm" class="mr-sm-2" placeholder="Search"></b-form-input>
                    <b-button size="sm" class="my-2 my-sm-0" type="submit">Search</b-button>
                </b-nav-form>
                <hr />
                <template>
                    <div>
                        <div>
                            排序:
                            <b>{{ sortDesc ? '倒序' : '正序' }}</b>
                        </div>
                        <b-table :items="items"
                                 :fields="fields"
                                 :sort-by.sync="sortBy"
                                 :sort-desc.sync="sortDesc"
                                 sort-icon-left
                                 responsive="sm" striped>
                            <template #cell(show_details)="row">
                                <b-button size="sm" @@click="row.toggleDetails" class="mr-2">
                                    {{ row.detailsShowing ? '隱藏' : '顯示'}}
                                </b-button>

                                <!-- As `row.showDetails` is one-way, we call the toggleDetails function on @@change -->
                                @*<b-form-checkbox v-model="row.detailsShowing" @@change="row.toggleDetails">
                                        Details via check
                                    </b-form-checkbox>*@
                            </template>

                            <template #row-details="row">
                                <b-card>
                                    <b-row>
                                        <b-col><b>訂單明細編號</b></b-col>
                                        <b-col><b>物品ID</b></b-col>
                                        <b-col><b>物品SN</b></b-col>
                                        <b-col><b>物品狀態</b></b-col>
                                    </b-row>
                                    <hr />
                                    <b-row v-for="item in row.item.orderDetails">
                                        <b-col>{{ item.orderDetailId }}</b-col>
                                        <b-col>{{ item.itemId }}</b-col>
                                        <b-col>{{ item.itemSn }}</b-col>
                                        <b-col>{{ item.orderDetailStatus }}</b-col>
                                    </b-row>



                                    <b-button size="sm" @@click="row.toggleDetails">隱藏</b-button>
                                </b-card>
                            </template>
                        </b-table>
                    </div>
                </template>
        </b-tab>
        <br />
        <!--PENDING ORDERS-->
        <b-tab title="待核可" v-on:click="GetPendingOrders">

            <b-navbar-nav class="ml-auto">
                <b-nav-form>
                    <b-form-input size="sm" class="mr-sm-2" placeholder="Search"></b-form-input>
                    <b-button size="sm" class="my-2 my-sm-0" type="submit">Search</b-button>
                </b-nav-form>
                <hr />
                <template>
                    <div>
                        <p>
                            <span>
                                <b-button size="sm" @@click="selectAllRows">全選</b-button>
                                <b-button size="sm" @@click="clearSelected">清除</b-button>
                            </span>
                            <span class="float-right">
                                <b-button size="sm" @@click="distributeItems()">核可</b-button>
                                <b-button size="sm" @@click="">拒絕</b-button>
                            </span>
                        </p>
                        <div>
                            排序:
                            <b>{{ sortDesc ? '倒序' : '正序' }}</b>
                        </div>
                        <b-table :items="items"
                                 :fields="fields"
                                 :select-mode="selectMode"
                                 responsive="sm"
                                 ref="selectableTable"
                                 :sort-by.sync="sortBy"
                                 :sort-desc.sync="sortDesc"
                                 sort-icon-left
                                 selectable
                                 @@row-selected="onRowSelected">

                            <!-- Example scoped slot for select state illustrative purposes -->
                            <template #cell(selected)="{ rowSelected }">
                                <template v-if="rowSelected">
                                    <span aria-hidden="true">&check;</span>
                                    <span class="sr-only">Selected</span>
                                </template>
                                <template v-else>
                                    <span aria-hidden="true">&nbsp;</span>
                                    <span class="sr-only">Not selected</span>
                                </template>
                            </template>
                        </b-table>
                        <p>
                            <span>
                                <b-button size="sm" @@click="selectAllRows">全選</b-button>
                                <b-button size="sm" @@click="clearSelected">清除</b-button>
                            </span>
                            <span class="float-right">
                                <b-button size="sm" @@click="">核可</b-button>
                                <b-button size="sm" @@click="">拒絕</b-button>
                            </span>
                        </p>
                        <p>
                            Selected Rows:<br>
                            {{ selected }}
                        </p>
                    </div>
                </template>

        </b-tab>

        <!--PICKUP ORDERS-->
        <b-tab title="待領取" v-on:click="PickUpOrders">
            <b-navbar-nav class="ml-auto">
                <b-nav-form>
                    <b-form-input size="sm" class="mr-sm-2" placeholder="Search"></b-form-input>
                    <b-button size="sm" class="my-2 my-sm-0" type="submit">Search</b-button>
                </b-nav-form>
                <hr />
                <template>
                    <div>
                        <div>
                            排序:
                            <b>{{ sortDesc ? '倒序' : '正序' }}</b>
                        </div>
                        <b-table :items="items" :fields="fields" :sort-by.sync="sortBy"
                                 :sort-desc.sync="sortDesc"
                                 sort-icon-left striped responsive="sm">
                            <template #cell(show_details)="row">
                                <b-button size="sm" @@click="row.toggleDetails" class="mr-2">
                                    {{ row.detailsShowing ? '隱藏' : '顯示'}}
                                </b-button>

                                <!-- As `row.showDetails` is one-way, we call the toggleDetails function on @@change -->
                                @*<b-form-checkbox v-model="row.detailsShowing" @@change="row.toggleDetails">
                                        Details via check
                                    </b-form-checkbox>*@
                            </template>

                            <template #row-details="row">
                                <b-card>
                                    <b-row>
                                        <b-col><b>訂單明細編號</b></b-col>
                                        <b-col><b>物品ID</b></b-col>
                                        <b-col><b>物品SN</b></b-col>
                                        <b-col><b>物品狀態</b></b-col>
                                        <b-col><b>動作</b></b-col>
                                    </b-row>
                                    <hr />
                                    <b-row v-for="item in row.item.orderDetails">
                                        <b-col>{{ item.orderDetailId }}</b-col>
                                        <b-col>{{ item.itemId }}</b-col>
                                        <b-col>{{ item.itemSn }}</b-col>
                                        <b-col>{{ item.orderDetailStatus }}</b-col>
                                        <b-col>
                                            <b-button size="sm" @@click="">領取</b-button>
                                            <b-button size="sm" @@click="">取消</b-button>
                                        </b-col>

                                    </b-row>



                                    <b-button size="sm" @@click="row.toggleDetails">隱藏</b-button>
                                </b-card>
                            </template>
                        </b-table>
                    </div>
                </template>


        </b-tab>

        <!--ONGOING ORDERS-->
        <b-tab title="租借中" v-on:click="OnGoingOrders">
            <b-navbar-nav class="ml-auto">
                <b-nav-form>
                    <b-form-input size="sm" class="mr-sm-2" placeholder="Search"></b-form-input>
                    <b-button size="sm" class="my-2 my-sm-0" type="submit">Search</b-button>
                </b-nav-form>
                <hr />
                <template>
                    <div>
                        <div>
                            排序:
                            <b>{{ sortDesc ? '倒序' : '正序' }}</b>
                        </div>
                        <b-table :items="items" :fields="fields" :sort-by.sync="sortBy"
                                 :sort-desc.sync="sortDesc"
                                 sort-icon-left striped responsive="sm">
                            <template #cell(show_details)="row">
                                <b-button size="sm" @@click="row.toggleDetails" class="mr-2">
                                    {{ row.detailsShowing ? '隱藏' : '顯示'}}
                                </b-button>

                                <!-- As `row.showDetails` is one-way, we call the toggleDetails function on @@change -->
                                @*<b-form-checkbox v-model="row.detailsShowing" @@change="row.toggleDetails">
                                        Details via check
                                    </b-form-checkbox>*@
                            </template>

                            <template #row-details="row">
                                <b-card>
                                    <b-row>
                                        <b-col><b>訂單明細編號</b></b-col>
                                        <b-col><b>物品ID</b></b-col>
                                        <b-col><b>物品SN</b></b-col>
                                        <b-col><b>物品狀態</b></b-col>
                                        <b-col><b>問題反映</b></b-col>
                                        <b-col><b>動作</b></b-col>
                                    </b-row>
                                    <hr />
                                    <b-row v-for="item in row.item.orderDetails">
                                        <b-col>{{ item.orderDetailId }}</b-col>
                                        <b-col>{{ item.itemId }}</b-col>
                                        <b-col>{{ item.itemSn }}</b-col>
                                        <b-col>{{ item.orderDetailStatus }}</b-col>
                                        <b-col><b-button size="sm" @@click="">查看</b-button></b-col>
                                        <b-col>
                                            <b-button size="sm" @@click="">歸還</b-button>
                                            <b-button size="sm" @@click="">遺失</b-button>
                                        </b-col>

                                    </b-row>



                                    <b-button size="sm" @@click="row.toggleDetails">隱藏</b-button>
                                </b-card>
                            </template>
                        </b-table>
                    </div>
                </template>
        </b-tab>
        <!--CLOSED ORDERS-->
        <b-tab title="已結束" v-on:click="ClosedOrders">
            <b-navbar-nav class="ml-auto">
                <b-nav-form>
                    <b-form-input size="sm" class="mr-sm-2" placeholder="Search"></b-form-input>
                    <b-button size="sm" class="my-2 my-sm-0" type="submit">Search</b-button>
                </b-nav-form>
                <hr />
                <template>
                    <div>
                        <div>
                            排序:
                            <b>{{ sortDesc ? '倒序' : '正序' }}</b>
                        </div>
                        <b-table :items="items" :fields="fields" :sort-by.sync="sortBy"
                                 :sort-desc.sync="sortDesc"
                                 sort-icon-left striped responsive="sm">
                            <template #cell(show_details)="row">
                                <b-button size="sm" @@click="row.toggleDetails" class="mr-2">
                                    {{ row.detailsShowing ? '隱藏' : '顯示'}}
                                </b-button>

                                <!-- As `row.showDetails` is one-way, we call the toggleDetails function on @@change -->
                                @*<b-form-checkbox v-model="row.detailsShowing" @@change="row.toggleDetails">
                                        Details via check
                                    </b-form-checkbox>*@
                            </template>

                            <template #row-details="row">
                                <b-card>
                                    <b-row>
                                        <b-col><b>訂單明細編號</b></b-col>
                                        <b-col><b>物品ID</b></b-col>
                                        <b-col><b>物品SN</b></b-col>
                                        <b-col><b>物品狀態</b></b-col>
                                    </b-row>
                                    <hr />
                                    <b-row v-for="item in row.item.orderDetails">
                                        <b-col>{{ item.orderDetailId }}</b-col>
                                        <b-col>{{ item.itemId }}</b-col>
                                        <b-col>{{ item.itemSn }}</b-col>
                                        <b-col>{{ item.orderDetailStatus }}</b-col>
                                    </b-row>



                                    <b-button size="sm" @@click="row.toggleDetails">隱藏</b-button>
                                </b-card>
                            </template>
                        </b-table>
                    </div>
                </template>
        </b-tab>
        <!--OVERDUE ORDERS-->
        <b-tab title="已逾期" v-on:click="OverDueOrders">
            <b-navbar-nav class="ml-auto">
                <b-nav-form>
                    <b-form-input size="sm" class="mr-sm-2" placeholder="Search"></b-form-input>
                    <b-button size="sm" class="my-2 my-sm-0" type="submit">Search</b-button>
                </b-nav-form>
                <hr />
                <template>
                    <div>
                        <div>
                            排序:
                            <b>{{ sortDesc ? '倒序' : '正序' }}</b>
                        </div>
                        <b-table :items="items" :fields="fields" :sort-by.sync="sortBy"
                                 :sort-desc.sync="sortDesc"
                                 sort-icon-left striped responsive="sm">
                            <template #cell(show_details)="row">
                                <b-button size="sm" @@click="row.toggleDetails" class="mr-2">
                                    {{ row.detailsShowing ? '隱藏' : '顯示'}}
                                </b-button>

                                <!-- As `row.showDetails` is one-way, we call the toggleDetails function on @@change -->
                                @*<b-form-checkbox v-model="row.detailsShowing" @@change="row.toggleDetails">
                                        Details via check
                                    </b-form-checkbox>*@
                            </template>

                            <template #row-details="row">
                                <b-card>
                                    <b-row>
                                        <b-col><b>訂單明細編號</b></b-col>
                                        <b-col><b>物品ID</b></b-col>
                                        <b-col><b>物品SN</b></b-col>
                                        <b-col><b>物品狀態</b></b-col>
                                        <b-col><b>問題反映</b></b-col>
                                        <b-col><b>動作</b></b-col>
                                        <b-col><b>罰金</b></b-col>
                                    </b-row>
                                    <hr />
                                    <b-row v-for="item in row.item.orderDetails">
                                        <b-col>{{ item.orderDetailId }}</b-col>
                                        <b-col>{{ item.itemId }}</b-col>
                                        <b-col>{{ item.itemSn }}</b-col>
                                        <b-col>{{ item.orderDetailStatus }}</b-col>
                                        <b-col><b-button size="sm" @@click="">查看</b-button></b-col>
                                        <b-col>
                                            <b-button size="sm" @@click="">歸還</b-button>
                                            <b-button size="sm" @@click="">遺失</b-button>
                                        </b-col>
                                        <b-col>還沒說怎麼計算!</b-col>
                                    </b-row>



                                    <b-button size="sm" @@click="row.toggleDetails">隱藏</b-button>
                                </b-card>
                            </template>
                        </b-table>
                    </div>
                </template>
        </b-tab>

    </b-tabs>
</div>
<br />
<br />




<script>
    let app = new Vue({
        el: '#app',

        data() {
            return {
                sortBy: 'orderId',
                sortDesc: false,
                fields: [
                    { key: 'orderId', label: '訂單編號', sortable: true },
                    { key: 'username', label: '使用者', sortable: true },
                    { key: 'equipmentId', label: '設備ID', sortable: true },
                    { key: 'equipmentName', label: '設備名稱', sortable: true },
                    { key: 'quantity', label: '數量', sortable: true },
                    { key: 'estimatedPickupTime', label: '預計取用日期', sortable: true },
                    { key: 'day', label: '租期', sortable: true },
                    { key: 'totalPrice', label: '總價', sortable: true },
                    { key: 'statusName', label: '狀態', sortable: true },
                    { key: 'orderTime', label: '下單時間', sortable: true },
                    { key: 'show_details', label: '明細' }
                ],
                items: [],
                orders: [], // 存一開始拿到的所有訂單
                selectMode: 'multi',
                selected: [],
            }
        },
        beforeCreate: function () {
            fetch('/OrderApi/GetOrders/', { method: 'GET' })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                })
                .then(response => {
                    this.items = this.orders = response;

                    // Calculate total price
                    for (let i = 0; i < this.orders.length; i++) {
                        this.orders[i].totalPrice =
                            this.orders[i].quantity *
                            this.orders[i].day *
                            this.orders[i].unitPrice;
                    }
                })
        },

        methods: {
            // 所有訂單
            GetAllOrders: function () {
                // 直接拿所有訂單，不用 filter
                this.items = this.orders;
            },
            //GetPendingOrders: this.GetAllOrders.filter(o => o.tabName === "待核可"),
            // 待核可
            GetPendingOrders: function () {
                this.fields = [
                    { key: 'selected', label: '選擇' },
                    { key: 'orderId', label: '訂單編號', sortable: true },
                    { key: 'username', label: '使用者', sortable: true },
                    { key: 'equipmentId', label: '設備ID', sortable: true },
                    { key: 'equipmentName', label: '設備名稱', sortable: true },
                    { key: 'quantity', label: '數量', sortable: true },
                    { key: 'estimatedPickupTime', label: '預計取用日期', sortable: true },
                    { key: 'day', label: '租期', sortable: true },
                    { key: 'totalPrice', label: '總價', sortable: true },
                    { key: 'statusName', label: '狀態', sortable: true },
                    { key: 'orderTime', label: '下單時間', sortable: true }];
                this.items = this.orders.filter(o => o.tabName === "待核可");
            },
            onRowSelected(items) {
                this.selected = items
            },
            selectAllRows() {
                this.$refs.selectableTable.selectAllRows()
            },
            clearSelected() {
                this.$refs.selectableTable.clearSelected()
            },
            // 待領取
            PickUpOrders: function () {
                this.fields = [
                    { key: 'orderId', label: '訂單編號', sortable: true },
                    { key: 'username', label: '使用者', sortable: true },
                    { key: 'equipmentId', label: '設備ID', sortable: true },
                    { key: 'equipmentName', label: '設備名稱', sortable: true },
                    { key: 'quantity', label: '數量', sortable: true },
                    { key: 'estimatedPickupTime', label: '預計取用日期', sortable: true },
                    { key: 'day', label: '租期', sortable: true },
                    { key: 'totalPrice', label: '總價', sortable: true },
                    { key: 'statusName', label: '狀態', sortable: true },
                    { key: 'orderTime', label: '下單時間', sortable: true },
                    { key: 'show_details', label: '明細' }];
                this.items = this.orders.filter(o => o.tabName === "待領取");
            },
            // 租借中
            OnGoingOrders: function () {
                this.fields = [
                    { key: 'orderId', label: '訂單編號', sortable: true },
                    { key: 'username', label: '使用者', sortable: true },
                    { key: 'equipmentId', label: '設備ID', sortable: true },
                    { key: 'equipmentName', label: '設備名稱', sortable: true },
                    { key: 'quantity', label: '數量', sortable: true },
                    { key: 'estimatedPickupTime', label: '預計取用日期', sortable: true },
                    { key: 'day', label: '租期', sortable: true },
                    { key: 'totalPrice', label: '總價', sortable: true },
                    { key: 'statusName', label: '狀態', sortable: true },
                    { key: 'orderTime', label: '下單時間', sortable: true },
                    { key: 'show_details', label: '明細' }];
                this.items = this.orders.filter(o => o.tabName === "租借中");
            },
            // 已結束
            ClosedOrders: function () {
                this.fields = [
                    { key: 'orderId', label: '訂單編號', sortable: true },
                    { key: 'username', label: '使用者', sortable: true },
                    { key: 'equipmentId', label: '設備ID', sortable: true },
                    { key: 'equipmentName', label: '設備名稱', sortable: true },
                    { key: 'quantity', label: '數量', sortable: true },
                    { key: 'estimatedPickupTime', label: '預計取用日期', sortable: true },
                    { key: 'day', label: '租期', sortable: true },
                    { key: 'totalPrice', label: '總價', sortable: true },
                    { key: 'statusName', label: '狀態', sortable: true },
                    { key: 'orderTime', label: '下單時間', sortable: true },
                    { key: 'show_details', label: '明細' }];
                this.items = this.orders.filter(o => o.tabName === "已結束");
            },
            // 已逾期
            OverDueOrders: function () {
                this.fields = [
                    { key: 'orderId', label: '訂單編號', sortable: true },
                    { key: 'username', label: '使用者', sortable: true },
                    { key: 'equipmentId', label: '設備ID', sortable: true },
                    { key: 'equipmentName', label: '設備名稱', sortable: true },
                    { key: 'quantity', label: '數量', sortable: true },
                    { key: 'estimatedPickupTime', label: '預計取用日期', sortable: true },
                    { key: 'day', label: '租期', sortable: true },
                    { key: 'totalPrice', label: '總價', sortable: true },
                    { key: 'statusName', label: '狀態', sortable: true },
                    { key: 'orderTime', label: '下單時間', sortable: true },
                    { key: 'show_details', label: '明細', }];
                this.items = this.orders.filter(o => o.tabName === "已逾期");
            }
        }
    })
</script>



